# 한컴독스 웹 자동화 에이전트

한컴독스(Hancom Docs) 웹 에디터를 Claude in Chrome 브라우저 자동화로 제어하는 에이전트 시스템.
이 CLAUDE.md가 오케스트레이터 역할을 하며, `.claude/commands/` 하위의 슬래시 커맨드(skill)들을 조율한다.

**⚠ 지원 범위: HWP(한글) 문서 전용.** 한컴독스에는 한셀(스프레드시트), 한쇼(프레젠테이션), 한워드 등 다른 문서 유형이 존재하지만, 본 에이전트는 HWP(한글) 문서의 생성/편집/관리만 지원한다. 다른 문서 유형은 scope 밖이며, 사용자에게 해당 기능은 지원하지 않는다고 안내한다.

---

## 에디터 식별

### URL 패턴
```
webhwp.hancomdocs.com/webhwp/?mode=HWP_EDITOR
```

### 탭 제목 패턴
```
*.hwpx - 한컴오피스 Web v2 한글
```

### 에디터 탭 찾기 절차
1. `tabs_context_mcp`로 탭 목록 조회
2. URL에 `webhwp.hancomdocs.com`이 포함된 탭 식별
3. 해당 탭이 없으면 사용자에게 안내 ("한컴독스 에디터를 먼저 열어주세요")
4. 여러 탭이 있으면 사용자에게 선택 요청

---

## 요청 처리 절차

**⚠ 모든 사용자 요청에 대해 반드시 다음 절차를 따른다:**

1. **쿼리 이해**: 사용자 요청의 내용과 맥락 파악
2. **목적 파악**: 최종 결과물이 무엇인지 정의
3. **수행 범위 결정**: 목적 달성에 필요한 작업 항목 도출
4. **실행 계획 수립**: 최종 산출물을 구체적으로 기획 (문서 구조, 내용 초안, 스타일/서식 등을 마크다운으로 설계) → 작업 항목과 필요한 skill 식별 → TODO 목록으로 정리
5. **실행**: 계획에 따라 순차 수행, 각 단계 완료 확인 후 다음 진행
6. **검증**: 각 단계 결과 및 최종 결과물이 목적에 부합하는지 확인, 미달 시 보정
7. **결과 보고**: 전체 완료 후 결과 간략히 보고

---

## 핵심 조작 패턴

### 1. 텍스트 입력 (가장 기본)
에디터 본문에 텍스트를 입력하는 방법:
1. 에디터 캔버스 영역 클릭하여 포커스 확보
2. `computer(type)` 액션으로 텍스트 입력
3. 줄바꿈: `computer(key, "Enter")`
4. **주의**: 한글 입력 시 IME 조합 고려 필요. 타이핑 후 다음 동작 전 짧은 대기 권장
5. **주의**: 긴 텍스트는 단락 단위로 나누어 입력하고, 각 단락 사이 Enter 키 사용

### 2. 요소 탐색 (동적 ref 대응)
에디터 UI 요소는 업데이트로 ref ID가 변경될 수 있으므로 **하드코딩 금지**.
항상 동적으로 탐색:
```
방법 1 (권장): find(query="스타일 드롭다운") → ref 획득 → 조작
방법 2: read_page(filter="interactive") → 원하는 요소 찾기 → 조작
방법 3: find(query="확인 버튼") → 클릭
```

### 3. 메뉴 접근
```
방법 1: 메뉴바에서 메뉴명 find → 클릭 → 하위 항목 find → 클릭
방법 2: 단축키 사용 (더 빠르고 안정적)
```

### 4. 다이얼로그 조작
1. 단축키 또는 메뉴로 다이얼로그 열기
2. `read_page` 또는 `find`로 다이얼로그 내 요소 탐색
3. `form_input` 또는 `computer(left_click)`으로 값 설정
4. 확인/적용 버튼 `find` → 클릭
5. **주의**: 다이얼로그가 열린 상태에서만 내부 요소 접근 가능
6. **⚠ 다이얼로그 내 Ctrl+A 사용 금지**: HWP 다이얼로그 입력 필드에서 Ctrl+A를 누르면 **에디터 본문 전체가 선택됨** (다이얼로그 필드 내용이 아님). 이후 type()하면 문서 전체가 삭제되어 **복구 불가**
7. **⚠ 다이얼로그 입력 필드 안전한 값 교체 방법**:
   - **권장**: `find`로 필드 찾기 → `left_click` → `key("Home")` → `key("shift+End")` → `type("새 값")`
   - **대안**: `find`로 필드 ref 획득 → `form_input(ref, "새 값")` (단, HWP 커스텀 필드에서는 DOM만 변경되고 내부 상태 미반영될 수 있음)
   - **금지**: `triple_click` → `type()` (일부 HWP 다이얼로그에서 기존 값에 추가됨, 대체 아님)

### 5. 도구 상자(툴바) 접근
서식 도구 상자 요소들은 `find`로 동적 탐색:
- 스타일 드롭다운: `find(query="스타일 드롭다운")` 또는 `find(query="바탕글")`
- 글꼴: `find(query="글꼴 입력")`
- 글자 크기: `find(query="글자 크기")`
- 정렬 버튼: `find(query="왼쪽 정렬")`, `find(query="가운데 정렬")` 등
- 줄간격: `find(query="줄간격")`

### 6. 표 내 이동 및 단축키
- `Tab`: 다음 셀 / `Shift+Tab`: 이전 셀
- 방향키: 셀 간 이동 (텍스트 끝에서)
- **⚠ Ctrl+F로 셀 진입 금지**: 표 내부 텍스트를 못 찾는 HWP 버그가 있어 신뢰 불가. **셀 진입은 직접 좌표 클릭**으로 수행 (screenshot → 셀 텍스트 중앙 좌표 확인 → left_click)
- **표 주요 단축키**: `S`(셀 나누기), `Ctrl+Enter`(줄 추가), `Ctrl+Backspace`(줄 삭제) → 상세: hdocs-table O절
- **⚠ P키**: 셀 블록 모드→표/셀 속성 열림, 셀 편집 모드→텍스트 "p" 입력됨. 편집 중에는 표 메뉴 → 표/셀 속성 사용
- **표 삭제**: 표 클릭하여 개체 선택(8개 핸들) → Delete
- **셀 블록 선택**: CDP `left_click_drag`로 가능 (재현성 주의, 패턴 20 참조)
  - F5(브라우저 새로고침)는 불가, JS synthetic event도 불가
  - 셀 블록 성공 시: 셀 합치기(M), 높이균등(H), 너비균등(W), Ctrl+방향키(크기조정), 블록 계산식 모두 사용 가능
  - 셀 블록 실패 시 대안: 표를 처음부터 올바른 구조로 설계
- **글자처럼 취급**: 표는 기본 체크, 그림은 무조건 체크
  - ⚠ 표가 쪽 경계에서 잘리는 경우: 표 선택 → 표/셀 속성 → "글자처럼 취급" 해제 → 표가 독립 개체로 전환되어 다음 쪽으로 자연 넘김
- 셀 크기 조정: 표 메뉴 → 표/셀 속성 → 셀 탭 → 너비/높이 입력 (P키 불가, 마우스 드래그 비추천)

### 7. 스타일 단축키 (Ctrl+숫자)
스타일 목록 순서 기반 매핑 (F6 다이얼로그의 목록 순서):
- `Ctrl+1` = 바탕글 (1번째)
- `Ctrl+2` = 본문 (2번째)
- `Ctrl+3` = 개요 1 (3번째)
- `Ctrl+4` = 개요 2 (4번째)
- ... `Ctrl+9` = 개요 7 (9번째)
- **주의**: 문서마다 스타일 목록이 다를 수 있으므로 F6으로 먼저 순서 확인 필요
- **주의**: 가끔 여러 번 눌러야 적용되는 경우 있음 (에디터 quirk)

### 8. 머리말/꼬리말/각주/미주 편집 모드
- 진입: 쪽 메뉴 → 머리말/꼬리말, 또는 입력 → 각주/미주 버튼
- 편집 모드 진입 시: 스타일 드롭다운이 "머리말"/"꼬리말"/"각주" 등으로 변경
  - 머리말/꼬리말: 글자크기 9.0pt, 줄간격 150
  - 각주: 글자크기 9.0pt, 줄간격 130
- **⚠ 편집 종료: 본문 영역 더블클릭 필수** (단일 클릭, Escape 키 모두 작동하지 않음)
- 종료 확인: 스타일 드롭다운이 "바탕글" 등으로 변경되면 본문 복귀 완료

### 9. 찾기/바꾸기
- `Ctrl+F`: **HWP 자체 찾기 다이얼로그** (브라우저 찾기 아님)
  - 구조: "찾을 내용" 입력, "찾을 방향" 라디오(아래로/위로/문서 전체), "다음 찾기", "닫기"
- `Ctrl+H`: HWP 찾아 바꾸기 다이얼로그
  - 구조: "찾을 내용"/"바꿀 내용" 입력, "바꾸기"/"다음 찾기"/"모두 바꾸기"/"닫기"
- **⚠ 찾을 방향 필수 사전 설정**: 다이얼로그는 설정된 방향으로만 찾음. 검색어 입력 전에 반드시 "문서 전체" 라디오를 선택하거나, 커서 위치 기준 적절한 방향 선택. 기본값 "아래로"이면 커서 뒤쪽만 검색됨
- **⚠ 찾기/바꾸기 필드 값 입력 시 주의**:
  - 이전 검색어가 필드에 남아있을 수 있음. **반드시 기존 값을 먼저 삭제** 후 입력
  - **안전한 방법**: 필드 클릭 → `Home` → `Shift+End` → `type("검색어")` (기존 값 선택 후 덮어쓰기)
  - **⚠ triple_click+type 금지**: 찾기/바꾸기 필드에서 기존 값에 추가됨 (대체 아님)
  - **⚠ Ctrl+A 금지**: 에디터 본문 전체가 선택되어 문서 파괴 위험 (패턴 4 참조)

### 10. 문자표 (Ctrl+F10)
- 다이얼로그 구조: 문자 영역 리스트, 문자 격자, 최근 사용한 문자, "입력 문자" 필드
- **권장 입력 방법**: "입력 문자" 필드 클릭 → 원하는 문자 직접 타이핑 → "넣기" 클릭
- 문자 격자 클릭은 불안정할 수 있으므로 직접 타이핑 권장

### 11. 개체(도형/글상자) 조작 패턴
- **도형 삽입**: 툴바 "도형" 버튼 클릭 → "그리기 개체" 도구 모음 → 도형 종류 선택 → 캔버스 드래그
- **글상자 삽입**: Alt+N → B → 캔버스 클릭 (기본 크기) 또는 드래그
- **개체 내부 편집 → 선택 모드**: Escape 1회 (8개 핸들 표시)
- **선택 해제 → 본문 복귀**: Escape 2회
- **개체 삭제**: 선택 상태에서 Delete
- **개체 내부 재진입**: 더블클릭

### 12. 수식 편집기 (부분 자동화)
- **열기**: 입력 메뉴 → 수식...
- **수식 코드 입력**: 하단 텍스트 입력 영역에 HWP 수식 문법으로 타이핑 가능
- **⚠ 다이얼로그 버튼 클릭 불가**: 수식 편집기는 WASM 캔버스 기반 렌더링으로, 내부 버튼(넣기/나가기/취소, 미리보기, 도구모음 기호)이 DOM에 노출되지 않아 자동화 클릭 불가
- **워크플로우**: 수식 코드 입력까지 자동화 → 사용자에게 "Escape → 넣기 버튼 클릭" 안내

### 13. F6 "설정..." 버튼 (JavaScript 필수)
F6 스타일 다이얼로그의 "설정..." 버튼 3개는 일반적인 방법(find, 좌표 클릭)으로 접근 불가.
`DIV[role="button"] > A > SPAN` 구조로, **JavaScript DOM 클릭만 작동**:
```javascript
const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT);
const btns = [];
while (walker.nextNode()) {
  if (walker.currentNode.textContent.trim() === '설정...') {
    const b = walker.currentNode.parentElement.closest('[role="button"]');
    if (b) btns.push(b);
  }
}
btns[0].querySelector('a').click(); // 문단 모양 설정
btns[1].querySelector('a').click(); // 글자 모양 설정
btns[2].querySelector('a').click(); // 글머리표/문단번호 설정
```
- **편집(연필) 버튼과 혼동 금지**: 연필은 이름만 편집, 속성은 "설정..."으로만 가능

### 14. 문서 내 페이지 이동
- **⚠ Page_Down/Page_Up 사용 금지**: 이 키들은 HWP 웹 에디터에서 **텍스트로 입력됨** (페이지 이동이 아님)
- **스크롤**: `computer(scroll, direction="down/up")` → 뷰포트 스크롤 (커서 이동 아님)
- **문서 처음/끝**: `Ctrl+Home` / `Ctrl+End` → 커서를 문서 처음/끝으로 이동
- **찾기로 이동**: `Ctrl+F` → 특정 텍스트 위치로 점프
- **줄 단위 이동**: `ArrowDown`/`ArrowUp` 반복 → 느리지만 정확

### 15. 브라우저 단축키 충돌 주의
다음 키는 브라우저가 가로채므로 HWP 기능으로 작동하지 않음:
- `F5`: 브라우저 새로고침 (HWP의 셀 블록 선택 불가, JS 우회·CDP 우회 모두 실패 확인)
- `Page_Down`/`Page_Up`: 에디터에서 텍스트로 입력됨 (페이지 이동 불가)
- `Ctrl+L`: 브라우저 주소창 포커스
- `Ctrl+T`: 브라우저 새 탭
- `Ctrl+W`: 브라우저 탭 닫기
- `Ctrl+N`: 브라우저 새 창

### 16. 표 탈출 (Shift+Esc)
- **Shift+Esc**: 표 안 어디서든 즉시 **표 위쪽**으로 커서 이동
- **⚠ 필수 검증**: Shift+Esc 후 screenshot으로 커서가 표 바깥인지 확인. 커서 깜빡임으로 안 보이면 screenshot 재촬영. **검증 통과 전 본문 입력 금지**. 실패 시 재시도 (최대 3회)
- **표 아래로 이동**: Shift+Esc(표 위쪽) 후 ArrowDown으로 표 아래로 이동, 또는 표 아래 영역 직접 클릭. 최후 수단: `Ctrl+End`(문서 끝 점프)

### 17. 장 표지 생성 ★
쪽나누기 → Enter×10~12 → 가운데+20pt+볼드 → 제목 → 쪽나누기. → hdocs-page E절 참조

### 18. Ctrl+숫자 매핑 JS 감지
F6 열린 상태에서 JS로 스타일 목록 순서 = Ctrl+숫자 매핑 추출:
```javascript
const dialog = document.querySelector('.modal_dialog');
const anchors = dialog.querySelectorAll('a');
const styles = Array.from(anchors)
  .map(a => a.textContent.trim())
  .filter(t => t.length > 0 && t !== '설정...');
// styles[0]=Ctrl+1, styles[1]=Ctrl+2, ..., styles[8]=Ctrl+9, styles[9]=Ctrl+0
```
- 11번째 이후는 Ctrl+숫자 접근 불가 → F6 또는 드롭다운 사용

### 19. 문단부호/격자 활성화 (보기 메뉴) ★ 필수
- **⚠ 작업 시작 시 반드시 활성화** (권장이 아닌 **필수**)
- **보기 메뉴 → 표시/숨기기 → 문단 부호** 활성화: 줄바꿈(↵), 빈 줄, 문단 경계 시각적 표시
- **보기 메뉴 → 격자 보기** 활성화: 표/개체 배치 가이드라인 표시
- **⚠ 단축키(Alt+G+T 등) 불가**: Alt+G가 "찾아가기"에 오버라이드됨 → **보기 메뉴 경로만 사용**
- 문단부호가 보여야 표/텍스트 위치를 정확히 파악 가능 → 좌표 클릭 정확도 직접 영향
- **⚠ 새로고침 시 초기화됨** → 새로고침 후 반드시 재활성화

### 20. 셀 블록 선택 (CDP 드래그)

CDP `left_click_drag`로 셀 블록 선택 가능. **시작점 = 내부 경계선 교차점(±3px)**이 핵심.
- 셀 내부 드래그→텍스트 선택 / **내부 경계선 교차점** 드래그→셀 블록 선택
- 검증: 상태바 `0/N글자`=셀블록, `N/M글자`=셀편집, `N글자`=본문
- 사용 가능: M(합치기), W(너비균등), H(높이균등), S(나누기), P(속성), Ctrl+방향키, 블록계산식
→ 7단계 알고리즘·제한사항·실패 대안: hdocs-table E절 참조

### 21. 표 셀 클릭 진입 — 좌표 정밀 확인 필수 ★

표 셀에 클릭으로 진입할 때 **눈대중 좌표는 높은 확률로 빗나간다**. 표 행은 스크린샷에서 매우 좁아서 (15~20px), 조금만 벗어나면 표 위/아래 본문에 커서가 들어간다.

```
[표 셀 클릭 절차]
1. screenshot 촬영
2. zoom(region=[표 영역])으로 표를 확대하여 정확한 셀 텍스트 좌표 파악
   → zoom 결과에서 셀 텍스트 중앙의 상대 위치 계산
   → 원래 screenshot 좌표로 역변환
3. 계산된 좌표로 left_click
4. 상태바 확인: "N/M글자" = 셀 진입 성공, "N글자" = 본문 (실패)
5. 실패 시 y를 ±5px 조정하여 재시도 (최대 3회)

[실패 원인 진단]
- 스타일 드롭다운이 "바탕글"+"11pt" 등 → 본문 텍스트에 닿음 (y를 더 아래로)
- 스타일이 "개요 N" → 제목/소제목에 닿음 (y를 더 아래로)
- 줄간격이 넓은 문단 바로 아래의 표는 생각보다 y가 훨씬 큼
```

**⚠ 표 생성 직후에는 커서가 이미 첫 셀 안에 있으므로 클릭 불필요** (Tab으로 이동)

### 22. JS 사용 범위 — 에디터 캔버스/스크롤 DOM 변경 금지 ★

HWP 웹 에디터의 **캔버스/스크롤 관련 DOM 속성**을 JavaScript로 직접 수정하면 WASM 엔진 내부 상태와 불일치가 발생한다.

```
[금지]
- hcwoViewScroll.scrollTop 변경 → 스크롤 상태 깨짐, 클릭 좌표 불일치
- pointer-events, display, visibility 등 레이아웃 속성 변경 → 효과 없거나 깨짐
- canvas에 synthetic MouseEvent dispatch → WASM이 무시함 (isTrusted 검사 추정)

[허용]
- F6 "설정..." 버튼 click() 호출 (패턴 13) → 기존 DOM 버튼 클릭, 정상 작동
- Ctrl+숫자 매핑 감지 (패턴 18) → DOM 읽기 전용
- 다이얼로그 내 요소 읽기/클릭 → 정상 작동
- read_page, find 등 MCP 도구 → 안전

[에디터 상태가 꼬였을 때]
→ 페이지 새로고침 (navigate로 같은 URL 재접속)이 유일한 해결책
```

### 23. 에디터 DOM 3층 구조

HWP 웹 에디터의 캔버스 영역은 3개 레이어로 구성 (위→아래):
```
1. hcwoViewScroll (DIV, position:fixed) — 스크롤/이벤트 처리
2. EditCanvas (CANVAS, position:fixed) — 편집 오버레이 (커서, 선택)
3. PaperCanvas (CANVAS, position:fixed) — 문서 렌더링
```
- 모든 클릭은 최상위 `hcwoViewScroll`에 도달 → WASM 엔진이 처리
- `elementFromPoint()` 결과는 항상 `hcwoViewScroll` (이것은 정상)
- 이 구조를 건드리면 안 됨 (패턴 22 참조)

### 24. Ctrl+End는 표 안에서 다르게 동작 ★

- **본문 모드**: Ctrl+End → 문서 마지막으로 커서 이동 (정상)
- **표 셀 편집 모드**: Ctrl+End → **표의 마지막 셀**로 이동 (문서 끝이 아님!)
- 표에서 완전히 빠져나온 후(`Shift+Esc`) Ctrl+End를 눌러야 문서 끝으로 감
- **⚠ 표 안에서 Ctrl+End → Enter → Alt+N+T = 표 안에 표 생성** (실수 주의)

### 25. 찾아가기 (Alt+G)
- `Alt+G` → 찾아가기 다이얼로그 (쪽/구역/줄/스타일/조판부호/책갈피로 이동)
- **⚠ Alt+G가 찾아가기를 먼저 잡음** → Alt+G+T(문단부호) 등 순차키 불가
- 특정 쪽으로 빠르게 이동할 때 유용 (예: 10쪽 → Alt+G → "10" 입력 → 가기)

### 26. 상태바/UI 정보 JS 읽기

screenshot 없이 에디터 상태 정보를 JS DOM으로 읽을 수 있다. **단, DOM 구조 변경 시 실패할 수 있으므로 screenshot 폴백 필수.**

```javascript
// 현재 쪽/글자수/구역/삽입모드 (복합 문자열)
document.querySelector('[data-name="status_page"]').textContent
// → "1/2쪽322글자구역:1 / 1삽입변경 내용 [기록 중지]"

// 개별 정보
document.querySelector('[data-name="cur_page"]').textContent   // "1"
document.querySelector('[data-name="total_page"]').textContent  // "2"
document.querySelector('[data-name="insert_mode"]').textContent // "삽입"
```

**활용 시나리오:**
- 셀 블록 확인: `0/N글자` 패턴 → 셀 블록 모드 (유일하게 구분 가능)
- 본문 또는 셀 편집: `N글자` 패턴 (슬래시 없음) → 본문 모드 또는 셀 편집 모드 (JS로 구분 불가, 구분 필요 시 screenshot)
- 현재 쪽 번호 확인: `cur_page` / `total_page`로 즉시
- 현재 스타일 확인: `document.querySelector('.e_style_item.on')?.textContent` → 현재 적용된 스타일명

**⚠ 폴백 규칙:**
1. JS 읽기 시도 → 값이 null/undefined/빈문자열이면 **screenshot으로 폴백**
2. 예상 패턴과 불일치하면 (파싱 실패 등) **screenshot으로 폴백**
3. 에디터 업데이트 후 data-name 속성이 변경될 수 있음 → 실패 시 무조건 screenshot

---

## 서식의 기본 원칙: 스타일 우선 + 온디맨드

### ★ 핵심 원칙: 반복 서식은 스타일로, 설정은 필요할 때만

스타일 기반 작업이 직접 서식 적용보다 효율적이고 일관성을 유지한다.
단, 모든 스타일을 **사전에 일괄 편집하지 않고**, 해당 스타일을 **처음 사용할 때** 확인/편집한다.

### ★ 기존 스타일 존중 원칙

**기존 스타일이 적합하면 그대로 사용. 부적합하면 사용자 확인 후 편집. 없으면 새로 생성.**
- 기존 문서의 스타일을 무단 변경하지 않음 (레이아웃 파괴 위험)
- **우선순위**: 기존 스타일 사용 > 기존 스타일 편집(확인 후) > 새 스타일 생성

**온디맨드**: 본문 즉시 시작 → 스타일 처음 사용 시 F6에서 확인/편집 → 이후 Ctrl+숫자로 반복.
- ✗ 사전 일괄 설정 (시간 낭비) / ✗ 직접 서식 반복 (일관성 깨짐) / ✗ 기존 스타일 무단 변경 (레이아웃 파괴)

### 스타일 편집 절차 (F6 → "설정..." 버튼) ★

F6 → 스타일 클릭 → **"설정..." JS 클릭**(패턴 13 코드 사용) → 글자/문단 모양 설정 → 확인.
- ⚠ 편집(연필) 버튼은 이름만 변경, 속성은 "설정..."으로만 가능
- 글자+문단 모양 **반드시 함께** 설정 (크기만 바꾸면 줄간격/여백이 빈약)
→ 상세 절차: hdocs-style D절, 줄간격/여백 기준: hdocs-style D절 문단 모양 다이얼로그 참조

### 한글 보고서 표준 번호 체계 (★ 핵심)

한글(HWP) 기반 보고서에서 가장 널리 쓰이는 계층적 번호/기호 체계:

```
제N장 ○○○○○          ← 장 제목 (장 스타일, 20pt, 볼드)
  N.1 ○○○○           ← 절 제목 (1.1 스타일, 15pt, 볼드)
    N.1.1 ○○○○       ← 소절 제목 (1.1.1 스타일, 13pt, 볼드)
      □ ○○○○         ← 대주제 (□ 스타일, 13pt, 내어쓰기)
        ○ ○○○○       ← 본문 내용 Lv1 (○ 내용1, 12pt)
          - ○○○○     ← 본문 내용 Lv2 (- 내용2, 12pt)
            · ○○○○   ← 본문 내용 Lv3 (· 내용3, 11pt)
          ※ ○○○○     ← 참고/주의 (※ 내용4, 11pt)
      가. ○○○○       ← 한글 번호 (가. 스타일)
```

각 수준은 독립 스타일(글꼴 크기·여백·글머리표 포함)로 정의. Ctrl+숫자 하나로 자동 적용.
→ 스타일별 설정값(크기/줄간격/여백/첫줄/정렬): hdocs-style "표준 스타일 설정값" 테이블 참조
**⚠ 설정값은 표준 참고용. 문서마다 다르므로 반드시 F6으로 현재 스타일 먼저 파악.**

### 스타일 설정 원칙 (문서별 적응)

문서마다 필요한 스타일이 다르다. 스타일 편집 시 확인: ① 글자(크기/볼드) ② 문단(줄간격/여백/정렬) ③ 문단 위 간격(제목에 필수) ④ 첫줄(기호 스타일은 내어쓰기).

### 표/그림 캡션 컨벤션

표: `<표 N-M> 제목` (표 위), 그림: `[그림 N-M] 제목` (그림 아래). N=장번호, M=순번.
→ 출처/주석/단위 형식 상세: hdocs-table M절 참조

### ⚠ 개요 스타일의 자동 번호 — 수동 번호 중복 금지 ★

HWP 개요 스타일(개요 1~10)은 **자동 번호가 내장**되어 있다:
- 개요 1 → "1.", "2.", "3." ...
- 개요 2 → "가.", "나.", "다." ...
- 개요 3 → "1)", "2)", "3)" ...

**⚠ 텍스트에 번호를 수동으로 포함하면 번호가 중복된다:**
```
[잘못된 예]
Ctrl+4(개요 2) → type("1. 테스트 환경 개요")
→ 결과: "가. 1. 테스트 환경 개요" (이중 번호!)

[올바른 예]
Ctrl+4(개요 2) → type("테스트 환경 개요")
→ 결과: "가. 테스트 환경 개요" (자동 번호만)
```

**원칙: 개요 스타일 사용 시 텍스트에는 제목/내용만 입력, 번호는 스타일이 자동 생성**

### 스타일 편집 후 문서 작성 패턴

스타일이 올바르게 설정되면, 본문 작성은 매우 단순해진다:
```
Ctrl+숫자 → type("내용") → Enter → Ctrl+숫자 → type("내용") → Enter ... 반복
```
글자 크기, 줄간격, 정렬, 여백 등을 매번 수동 지정할 필요 없음.

### 구조화 문서의 계층 개념

HWP 스타일은 구조화 문서의 계층을 나타낸다:
```
[계층 구조]
제목 스타일 = 절/소절 제목 → 자동 번호 포함, 문단 위 간격으로 섹션 구분
항목 스타일 = 본문 내용 나열 (○, -, · 등) → 왼쪽 여백과 글머리표로 수준 표현
바탕글      = 꾸밈 없는 일반 텍스트 (사용 빈도 낮음)

[한국 공문서 특성]
★ 서양 보고서의 "본문(body text)"에 해당하는 내용도 글머리표 스타일(○ 등)로 작성하는 경우가 많음
★ 즉, 바탕글(plain text)은 거의 사용하지 않고, 대부분의 서술이 ○/- 등 항목 스타일로 들어감
★ 제목 → ○ 항목 → 하위 - 항목 → 제목 → ○ 항목 ... 이 일반적인 흐름
★ 제목 스타일에 번호가 내장되어 있으므로 텍스트에 번호 불포함

[작성 흐름 예시]
절 제목 → ○ 주요 내용 서술 → - 세부 내용 → - 세부 내용 → 소절 제목 → ○ 내용 → ...
```

### 부분적 직접 서식이 필요한 경우

스타일로 해결되지 않는 **예외적 상황**에서만 직접 서식 적용:
- 본문 중 특정 단어만 **진하게/기울임**: 해당 텍스트 선택 → Ctrl+B / Ctrl+I
- 특정 텍스트 **글자색** 변경: 선택 → find("글자색") → 색상 선택
- 특정 텍스트 **형광펜**: 선택 → find("형광펜") → 색상 선택
- **자간** 미세 조정: 선택 → Alt+L → 자간 값 입력
- **표 내부 셀 서식**: 스타일 적용이 불완전할 수 있어 직접 크기/정렬 설정

---

## Skill 라우팅 규칙

Skill 파일 경로: `.claude/commands/hdocs-{skill명}.md`

### Skill 로드 트리거

| skill | 로드 조건 |
|-------|----------|
| navigate | **기본 로드**: 에디터 내 모든 작업 (탐색, 텍스트 입력, 저장) |
| table | **기본 로드**: 에디터 내 문서 작성/편집 작업 시 항상 |
| style | **기본 로드**: 에디터 내 문서 작성/편집 작업 시 항상 |
| format | 글자/문단 직접 서식 (글자 모양, 문단 모양) |
| page | 용지 설정, 머리말/꼬리말, 쪽번호, 구역 |
| insert | 그림, 도형, 글상자, 수식, 문자표 삽입 |
| write | 문서 전체 자동 생성, 보고서 작성 |
| dashboard | 에디터 탭 없음 / 파일·폴더·내 드라이브 관리 |

**⚠ 트리거 조건에 해당하는 skill은 반드시 로드한다.** 추가로, 조건에 명시되지 않았더라도 작업 중 필요하다고 판단되면 자유롭게 로드한다.

### 복합 작업 오케스트레이션 ★

여러 skill 영역에 걸치는 작업은, 실행 계획(요청 처리 절차 4단계)에서 필요한 skill들을 식별하고, 각 단계에서 해당 skill 파일을 `Read` 도구로 `.claude/commands/hdocs-{skill명}.md` 로드하여 상세 절차를 따른다.

#### Skill 로드 원칙
- **필요한 skill은 모두 로드**: 실행 계획에서 식별된 skill은 빠짐없이 해당 단계에서 Read로 로드
- **크로스레퍼런스 해소**: `→ hdocs-{skill} {절} 참조` 형태를 만나면, 해당 skill 파일을 Read로 로드하여 참조된 절차를 따른다

#### 예시
```
"표 만들고 개요 스타일 적용해줘"
→ ① Read(hdocs-table.md) → 표 생성
→ ② Read(hdocs-style.md) → 스타일 적용

"용지 A3로 바꾸고 3행 5열 표 넣어줘"
→ ① Read(hdocs-page.md) → F7 용지 설정
→ ② Read(hdocs-table.md) → 표 생성

"머리말에 제목 넣고 꼬리말에 쪽번호 넣어줘"
→ Read(hdocs-page.md) → 머리말/꼬리말 절차 참조 → 순차 실행
```

---

## 공통 에러 처리

### 다이얼로그 미열림
- 증상: 단축키 입력 후 다이얼로그 요소를 찾을 수 없음
- 대응: 에디터 캔버스 클릭 → 포커스 확보 → 단축키 재시도

### 요소를 찾을 수 없음
- 증상: `find`가 결과 없음 반환
- 대응: `read_page`로 현재 페이지 상태 전체 확인 → 대체 쿼리로 재탐색

### 입력 포커스 분실
- 증상: 텍스트 입력이 에디터가 아닌 다른 곳에 됨
- 대응: 에디터 캔버스 영역 클릭 → 입력 재시도

### 메뉴/다이얼로그 잔여
- 증상: 이전 메뉴나 다이얼로그가 닫히지 않음
- 대응: `Escape` 키 전송 → 상태 확인

---

## 문서 톤앤매너 파악 및 유지

문서 작성 시 톤앤매너는 **사전 정의하지 않고, 실제 문서를 보고 동적으로 판단**한다.

### 톤앤매너 파악 절차 (문서 작업 시작 전 필수)
1. **기존 문서 내용 확인**: `get_page_text` 또는 screenshot으로 현재 문서 내용 읽기
2. **문체 패턴 분석**: 어미(~임, ~이다, ~합니다 등), 서술/개조식 여부, 경어 수준
3. **구조 패턴 분석**: 번호 체계, 들여쓰기 규칙, 단락 구분 방식
4. **서식 패턴 분석**: F6 스타일, 글꼴/크기, 줄간격, 정렬 방식
5. **일관성 유지**: 파악한 패턴을 새로 작성하는 내용에 그대로 적용

### 적용 원칙
- **사용자 지시 최우선**: 사용자가 문체/형식을 지정하면 그에 따름
- **기존 문서 맥락 따르기**: 기존 문서에 추가/수정 시 기존 톤앤매너를 그대로 따름
- **새 문서**: 사용자에게 문서 유형/용도를 물어보고, 적절한 톤앤매너로 작성
- **일관성**: 한 문서 내에서 문체, 번호 체계, 표현 방식 통일

---

## 스타일 파악 (온디맨드)

**스타일은 문서마다 정의가 다르다.** 스타일을 처음 사용할 때 확인하고, 부적합하면 그때 편집한다.

### 파악 시점 및 절차
- **스타일을 처음 적용할 때** / **커스텀 스타일이 필요할 때** — 사전 일괄 파악하지 않음
- F6 열기 → 해당 스타일 속성 확인 → 부적합하면 "설정..." JS 클릭으로 즉시 편집 → 적합하면 Ctrl+숫자로 적용

### 갭 분석 (커스텀 스타일이 다수 필요할 때)

커스텀 스타일 5개+ 필요 시, 개별 온디맨드보다 일괄 생성이 효율적:
1. F6 → JS로 현재 스타일 목록 추출 (패턴 18)
2. 문서 유형별 필요 스타일과 비교 (실전 보고서: □○-· 등 / 간단 보고서: 개요 1~3)
3. 누락 스타일 사용자에게 제안 → 승인 시 배치 생성(hdocs-style G절) / 거부 시 대체 매핑(hdocs-style I절)
4. 기존 스타일 속성 부적합 시: 사용자 확인 후 편집

★ 간단한 문서(개요 1~3으로 충분)에서는 이 절차를 건너뛰고 개별 온디맨드

---

## 참조 파일

- `references/hdocs-help-urls.md`: 공식 도움말 URL 목록
- `.claude/commands/hdocs-*.md`: 각 기능별 skill 커맨드

---

## 편집 속도 최적화 원칙

에이전트의 문서 편집 속도를 높이기 위한 핵심 원칙:

### 1. 배치 입력 (가장 중요)
- **긴 텍스트는 한 번의 `type()` 호출로 입력** (문장마다 나누지 않음)
- 한 단락 전체를 하나의 type()으로 입력 후 Enter
- 예시: `type("첫 문장. 두 번째 문장. 세 번째 문장.")` → Enter
- **줄바꿈이 필요한 경우** (글머리 기호 스타일 등): 한 항목 입력 → Enter → 스타일 전환(Ctrl+숫자) → 다음 항목 입력. 스타일이 같으면 Enter만으로 연속 입력
- **단, 500자 초과 시에만 분할** (IME 안정성)

### 2. 스크린샷 최소화
- **모든 동작 후 스크린샷을 찍지 않는다** → 핵심 체크포인트에서만 촬영
- 체크포인트: ① 작업 시작 전 상태 확인 ② 다이얼로그 열림 확인 ③ 작업 완료 후 최종 확인
- 텍스트 입력 중간에는 스크린샷 불필요
- **상태 확인은 JS 읽기 우선** (패턴 26): 쪽 번호, 셀 모드 등 단순 상태는 JS DOM으로 읽고, 실패 시 screenshot 폴백

### 3. 키보드 단축키 우선
- `find()` → 클릭 대신 **단축키로 직접 실행** (더 빠르고 안정적)
- 스타일 적용: F6 다이얼로그 대신 `Ctrl+숫자`
- 저장: 메뉴 대신 `Ctrl+S`
- 진하게/기울임: find 대신 `Ctrl+B` / `Ctrl+I`

### 4. find() 호출 최소화
- 세션 초반에 `read_page(filter="interactive")`로 주요 요소 ref를 한 번 파악
- 파악한 ref를 이후 작업에서 재사용 (같은 세션 내에서는 ref 유지됨)
- **단, ref는 페이지 리로드/다이얼로그 열닫 시 변경될 수 있으므로 주의**

### 5. 온디맨드 작업 흐름
- 본문 작성을 즉시 시작, 설정은 필요할 때만 수행
- 스타일: 처음 사용 시점에 확인/편집, 이후 Ctrl+숫자로 반복
- 머리말/꼬리말: 본문 완성 후 추가
- 다이얼로그를 열고 닫는 횟수를 최소화

### 6. 불필요한 wait 제거
- `wait(0.3)`은 IME 조합이 필요한 경우에만 사용
- 영문/숫자 입력 후에는 wait 불필요
- 단축키 실행 후에는 다이얼로그 확인만으로 충분

### 7. 배치 작업 패턴 (표/스타일)
- **표 배치 입력**: type→Tab→type→Tab 연속으로 한 행씩 빠르게 입력 (hdocs-table K절)
- **헤더 서식**: 볼드가 Tab으로 전파되지 않으므로 각 셀마다 Ctrl+B 필요 (hdocs-table L절)
- **스타일 배치 생성**: F6에서 이름 일괄 등록(1패스) → 속성 일괄 설정(2패스) (hdocs-style G절)
- **표 탈출**: Shift+Esc → 상태바 검증 필수 (패턴 16) → ArrowDown으로 표 아래 이동

---

## 주의사항

1. **ref ID 하드코딩 금지**: 에디터 업데이트로 ref가 변경될 수 있음. 항상 `find` 또는 `read_page`로 동적 탐색
2. **에디터 포커스 확인**: 모든 키보드 조작 전 에디터가 포커스를 갖고 있는지 확인
3. **한글 IME 고려**: 한글 입력 후 다음 동작이 **키보드 단축키**인 경우에만 짧은 대기. type → type 연속은 대기 불필요
4. **스크린샷 활용**: 핵심 체크포인트에서만 촬영 (속도 최적화 원칙 참조)
5. **단계별 확인**: 복잡한 작업은 각 단계 완료를 확인한 후 다음 단계 진행
6. **Page_Down/Page_Up 절대 사용 금지**: 텍스트로 입력되어 문서 훼손됨
